<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Product Configurator</title>
    <style>
        body { margin: 0; overflow: hidden; }
        canvas { display: block; }
        #controls { position: absolute; top: 10px; left: 10px; z-index: 1; }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js.map"></script>
</head>
<body>
    <div id="controls">
        <button id="snapshot">Take Snapshot</button>
        <button id="exportConfig">Export Config</button>
        <input type="color" id="colorPicker" value="#ff0000">
        <label for="colorPicker"> Chair Color</label>
        <select id="materialSelect">
            <option value="basic">Basic Material</option>
            <option value="phong">Phong Material</option>
            <option value="standard">Standard Material</option>
        </select>
        <label for="materialSelect"> Material Type</label>
    </div>
    <script>
        let scene, camera, renderer, chair;
        let chairColor = 0xff0000, chairMaterialType = 'basic';
        
        init();
        animate();

        function init() {
            // Scene
            scene = new THREE.Scene();

            // Camera
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 5, 10);
            
            // Renderer
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.physicallyCorrectLights = true;
            renderer.shadowMap.enabled = true;
            document.body.appendChild(renderer.domElement);
            
            // Light
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
            scene.add(ambientLight);
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.7);
            directionalLight.position.set(5, 10, 7.5);
            directionalLight.castShadow = true;
            scene.add(directionalLight);
            
            // Ground
            const planeGeometry = new THREE.PlaneGeometry(20, 20);
            const planeMaterial = new THREE.ShadowMaterial({ opacity: 0.5 });
            const plane = new THREE.Mesh(planeGeometry, planeMaterial);
            plane.rotation.x = - Math.PI / 2;
            plane.receiveShadow = true;
            scene.add(plane);
            
            // Chair Model
            createChair();
            
            // Event Listeners
            document.getElementById("colorPicker").addEventListener("input", (event) => {
                chairColor = parseInt(event.target.value.replace('#', '0x'));
                updateChairMaterial();
            });
            
            document.getElementById("materialSelect").addEventListener("change", (event) => {
                chairMaterialType = event.target.value;
                updateChairMaterial();
            });
            
            document.getElementById("snapshot").onclick = takeSnapshot;
            document.getElementById("exportConfig").onclick = exportConfig;

            window.addEventListener('resize', onWindowResize, false);
        }

        function createChair() {
            const geometry = new THREE.Group();

            const seatGeometry = new THREE.BoxGeometry(3, 0.2, 3);
            const seatMaterial = new THREE.MeshStandardMaterial({color: chairColor});
            const seat = new THREE.Mesh(seatGeometry, seatMaterial);
            seat.position.y = 1.2;
            geometry.add(seat);

            const legGeometry = new THREE.CylinderGeometry(0.1, 0.1, 2, 16);
            for (let i = 0; i < 4; i++) {
                const leg = new THREE.Mesh(legGeometry, seatMaterial);
                leg.position.set((i % 2 === 0 ? -1 : 1) * 1.35, 0.1, (i < 2 ? -1 : 1) * 1.35);
                leg.rotation.z = Math.PI / 2;
                seat.castShadow = true;
                geometry.add(leg);
            }

            chair = geometry;
            scene.add(chair);
        }

        function updateChairMaterial() {
            let material;
            if (chairMaterialType === 'basic') {
                material = new THREE.MeshBasicMaterial({ color: chairColor });
            } else if (chairMaterialType === 'phong') {
                material = new THREE.MeshPhongMaterial({ color: chairColor });
            } else {
                material = new THREE.MeshStandardMaterial({ color: chairColor });
            }

            chair.traverse((object) => {
                if (object.isMesh) {
                    object.material = material;
                }
            });
        }

        function takeSnapshot() {
            renderer.toDataURL("image/png").then((dataUrl) => {
                const link = document.createElement('a');
                link.download = 'snapshot.png';
                link.href = dataUrl;
                link.click();
            });
        }

        function exportConfig() {
            const config = {
                color: chairColor.toString(16),
                material: chairMaterialType
            };
            const json = JSON.stringify(config);
            const blob = new Blob([json], { type: "application/json" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = "config.json";
            a.click();
            URL.revokeObjectURL(url);
        }

        function animate() {
            requestAnimationFrame(animate);
            renderer.render(scene, camera);
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }
    </script>
</body>
</html>